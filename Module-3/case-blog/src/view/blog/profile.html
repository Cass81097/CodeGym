<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <title>Profile</title>
   <link rel="stylesheet" href="css/profile/header.css">
   <link rel="stylesheet" href="css/profile/left-sidebar.css">
   <link rel="stylesheet" href="css/profile/right-sidebar.css">
   <link rel="stylesheet" href="css/profile/main-content.css">
   <link rel="stylesheet" href="css/profile/style.css">
   <link rel="stylesheet" href="css/profile/profile.css">
   <link rel="stylesheet" href="css/profile/about.css">
   <link rel="stylesheet" href="css/profile/user-profile.css">
   <link rel="stylesheet" href="css/profile/content-image.css">
   <link rel="stylesheet" href="css/profile/button.css">
   <link rel="stylesheet" href="css/profile/select.css">
   <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
      crossorigin="anonymous"></script>
   <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
   <link rel="stylesheet" href="https://cdn.materialdesignicons.com/3.6.95/css/materialdesignicons.min.css">

</head>

<body>
   <header>
      <div class="fb-nav">
         <div class="title">
            <a href="home">F4kebook</a>
         </div>
         <div class="search-box">
            <i class='bx bx-search icon-search'></i>
            <input id="search-card" type="search" placeholder="Tìm kiếm trên F4kebook">
         </div>
         <div class="home-media">
            <div class="social-media">
               <a href="" data-toggle="tooltip" data-placement="bottom" title="Messenger"><i
                     class='bx bxl-messenger'></i></a>
               <a href="" data-toggle="tooltip" data-placement="bottom" title="Thông báo"><i
                     class='bx bxs-bell'></i></a>
            </div>

            <!-- <div class="ava">
               <a href=""><i class="bx avatar online" data-toggle="tooltip" data-placement="bottom" title="Tài khoản"
                     style="background-image: url('../../img/home/avatar.jpg');"></i></a>
            </div> -->
            {avatar}
         </div>

      </div>
   </header>

   <div class="fb-container">
      <div class="left-sidebar">
         <div class="container-top-content">
            <li class="links">
               <a href="home">
                  <i class='select1 bx bxs-home icon' style="color: black"></i>
               </a>
            </li>
            <!-- <li class="links link-avatar">
               <a href="">
                  <div class="left-ava"><i class="select bx left-avatar"
                        style="background-image: url('../../img/home/avatar.jpg');"></i></div>
               </a>
            </li> -->
            {sidebar-avatar}
         </div>

         <div class="mid-content">
            <li>
               <a href="">
                  <i class='watch icon'></i>
               </a>
            </li>

            <li>
               <a href="">
                  <i class='page icon'></i>
               </a>
            </li>

            <li>
               <a href="">
                  <i class='market icon'></i>
               </a>
            </li>

            <li>
               <a href="">
                  <i class='game icon'></i>
               </a>
            </li>

            <li>
               <a href="">
                  <i class='all-list icon'></i>
               </a>
            </li>
         </div>

         <div class="bottom-content">
            <li>
               <a href="">
                  <i class='bx bx-group icon'></i>
               </a>
            </li>

            <li>
               <a href="">
                  <i class='shortcut icon'></i>
               </a>
            </li>
         </div>
      </div>

      <!-- profile page  -->

      <!-- <div class="profile-container">
         <img src="../../img/my-img/background-profile.jpg" class="cover-img">
         <div class="profile-details">
            <div class="pd-left">
               <div class="pd-row">
                  <img class="pd-image" src="img/avatar-main.jpg">
                  <div>
                     <h3>Trương Hoàng Anh</h3>
                     <p>1000 bạn bè - 20 bạn chung</p>
                     <img src="img/my-img/hiep.jpg">
                     <img src="img/my-img/nhuanh.jpg">
                     <img src="img/my-img/quynh.jpg" width="200px">
                     <img src="img/my-img/trananh.jpg">
                  </div>
               </div>
            </div>
         <div class="pd-right">
            <div class="add-button">
               <button type="button" class="btn btn-primary btn-add">
                  <i class="fas fa-plus fa-xa"><span>Thêm vào tin</span></i>
               </button>
            </div>
            <div class="edit-button">
               <button type="button" class="btn btn-secondary btn-edit">
                  <i class="fas fa-pen fa-xz"><span>Chỉnh sửa trang cá nhân</span></i>
               </button>
            </div>
         </div>
      </div> -->
      {profile-container}

      <div class="all-task">

         <div class="post-task select" >
            <a href="profile"><span>Bài viết</span></a>
         </div>
         <div class="profile-task">
            <a href="about"><span>Giới thiệu</span></a>
         </div>
      </div>

      <!-- Profile-Content -->

      <div class="profile-info">
         {info-col}
         <!-- <div class="info-col">
            <div class="about-info">
               <h5>Giới thiệu</h5>
            </div>

            <div class="profile-about">
               <div class="class-profile">
                  <i class="fas fa-graduation-cap icon-profile"></i>
                  <span>Từng học tại ${blog.college}</span>
               </div>

               <div class="address-profile">
                  <i class="fas fa-map-marker-alt icon-profile"></i>
                  <span>Đến từ ${blog.address}</span>
               </div>

               <div class="picture-profile">
                  <div class="picture-profile-1"
                     style="background-image: linear-gradient(transparent, rgba(0,0,0,0.5)), url(${blog.avatar});">
                  </div>
               </div>
            </div> -->
      </div>

      <div class="post-col">
         {post-col}
         <!-- <div class="home-content">
               <div class="write-post-container">
                  <div class="user-profile">
                     <img src="${blog.avatar}">
                     <div>
                        <p>${blog.name}</p>
                        <small>Public
                           <i class="fas fa-caret-down"></i>
                        </small>
                     </div>
                  </div>
               </div>
                                         
               <div class="post-input-container">
                 <textarea name="textarea" id="textarea" placeholder="Bạn đang nghĩ gì thế?" rows="3"></textarea> 
                  <div class="add-post-links">
                     <a href="#"><img src="img/live-video.png"> Video trực tiếp</a>
                     <a href="#"><img src="img/photo.png"> Ảnh/video</a>
                     <a href="#"><img src="img/feeling.png"> Cảm xúc/hoạt động</a>

                  </div>
               </div>
            </div> -->

         {index-content}
         <!-- <div class="index-content">
               <div class="post-container">
                  <div class="user-profile">
                     <img src="${blog.avatar}">
                     <div>
                        <p>${blog.name}</p>
                        <div class="time-status">
                           <span>8 tháng 7 lúc 20:20</span>
                           <i class="fas fa-globe-americas" style="color: #65676B;"></i>
                        </div>
                     </div>
                  </div>
                  <div class="post-user">
                     <p class="post-text">${blog.content}</p>
                     <img src="${blog.image}" class="post-img">

                     <div class="activity-icons">
                     </div>
                  </div>
               </div>
            </div> -->
      </div>
   </div>



   </div>

   </div>
   </div>

   <!-- Add-New-Img-Content -->
   <div class="modal fade" id="modal-add-new-img-content" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
         <div class="modal-content">
            <div class="modal-header">
               <h1 class="modal-title fs-5" id="modal-title">Thêm ảnh mới :</h1>
               <button type="button" data-bs-dismiss="modal" class="btn-close" aria-label="Close"></button>
            </div>
            <div id="form-add-content">
               <div class="modal-body" style="background-color: #f9f8fb; padding-bottom: 5px;">
                  <div class="mb-avatar">
                     <label for="formFile" class="form-label inputcode"><span>Chọn ảnh :</span></label>
                     <input type="file" id="image-upload" onchange="uploadImage(event)" hidden>
                     <label for="image-upload" class="file-upload-button">Choose File</label>
                     <span id="file-name" style="font-size: 0px;"></span>
                     <div class="info-progress">
                        <div class="progress">
                           <div id="upload-progress" class="progress-bar progress-bar-striped progress-bar-animated"
                              role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"
                              style="width: 0; min-width: 2em;" hidden="">0%
                           </div>
                        </div>
                        <div class="image-url" hidden>
                           <img src="" alt="" id="image-url">
                        </div>
                     </div>
                     <input value="" id="image" class="form-control" type="text" name="avatar" hidden>
                  </div>
                  <div class="mb-notice" hidden>
                     <span id="notice"></span>
                  </div>
               </div>
               <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                  <button id="btn-savecard" class="btn btn-primary ps-5 pe-5" data-bs-dismiss="modal">Ok</button>
               </div>
            </div>
         </div>
      </div>
   </div>

   <!-- Add IMG -->
   <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-app.js";
      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries

      // Your web app's Firebase configuration
      const firebaseConfig = {
         apiKey: "AIzaSyDxG2vMNkqz1sf4UGAaMzcaq3lVdAN5C8M",
         authDomain: "users-8f542.firebaseapp.com",
         projectId: "users-8f542",
         storageBucket: "users-8f542.appspot.com",
         messagingSenderId: "351740883393",
         appId: "1:351740883393:web:b9c6a3bba9f040cf3ebf40",
         measurementId: "G-KN5Q9HHHL7"
      };
      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
   </script>

   <script type="module">
      import {
         getStorage,
         ref,
         uploadBytesResumable,
         getDownloadURL
      } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-storage.js";

      const storage = getStorage();

      // Create the file metadata
      /** @type {any} */
      const metadata = {
         'jpg': 'images/jpg',
         'jpeg': 'images/jpeg',
         'png': 'images/png'
      };


      function uploadImage(e) {

         var input = event.target;
         if (input.files && input.files[0]) {
            var fileName = input.files[0].name;
            document.getElementById("file-name").textContent = fileName;
         }

         document.getElementById("image-upload").disabled = true
         // let uploader = document.getElementById('uploader');
         let file = e.target.files[0];

         // Upload file and metadata to the object 'images/mountains.jpg'
         const storageRef = ref(storage, 'images/' + file.name);
         const uploadTask = uploadBytesResumable(storageRef, file, metadata);
         document.getElementById("upload-progress").hidden = false;

         // Listen for state changes, errors, and completion of the upload.
         uploadTask.on('state_changed',
            (snapshot) => {
               // Get task progress, including the number of bytes uploaded and the total number of bytes to be uploaded
               const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
               console.log('Upload is ' + progress + '% done');
               let progressBar = document.getElementById("upload-progress");
               let progressImg = document.querySelector(".progress");
               progressBar.style.width = Math.round(progress) + "%";
               progressBar.innerHTML = Math.round(progress) + "%";
               progressImg.style.margin = "0px 0px 10px 0px";
               const divElement = document.querySelector('.image-url');
               divElement.removeAttribute('hidden');
               const inputElement = document.getElementById('image');
               inputElement.readOnly = true;
               switch (snapshot.state) {
                  case 'paused':
                     console.log('Upload is paused');
                     break;
                  case 'running':
                     console.log('Upload is running');
                     break;
               }
            },
            (error) => {
               // A full list of error codes is available at
               // https://firebase.google.com/docs/storage/web/handle-errors
               switch (error.code) {
                  case 'storage/unauthorized':
                     // User doesn't have permission to access the object
                     break;
                  case 'storage/canceled':
                     // User canceled the upload
                     break;

                  // ...

                  case 'storage/unknown':
                     // Unknown error occurred, inspect error.serverResponse
                     break;
               }
            },
            () => {
               // Upload completed successfully, now we can get the download URL
               getDownloadURL(uploadTask.snapshot.ref).then((downloadURL) => {
                  console.log('File available at', downloadURL);
                  const pElement = document.querySelector('.mb-notice');
                  pElement.removeAttribute('hidden');
                  document.getElementById('notice').textContent = 'Hoàn thành!!!';
                  let image = document.getElementById('image');
                  let imageContent = document.getElementById('image-content');
                  image.value = downloadURL;
                  document.getElementById('image-url').src = downloadURL;
                  // pushNewIMG(downloadURL)
                  setTimeout(() => {
                     document.getElementById("image-upload").disabled = false;
                  }, 500)
               });
            }
         );
      }

      window.uploadImage = uploadImage;

   </script>

   <script>
      function confirmDeleteCookie() {
         if (confirm("Bạn có chắc chắn đăng xuất không?")) {
            deleteCookie();
            window.location.href = "sign-in";
         }
      }
      function deleteCookie() {
         document.cookie = "userID=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
      }
   </script>

   <script>
      function handleDelete(postId) {
         if (confirm("Bạn có chắc muốn xóa bài đăng này không?")) {
            sendFetchDelete(postId);
         }
      }
   </script>

   <script>
   </script>
   <script src="../../js/delete.js"></script>
</body>

</html>